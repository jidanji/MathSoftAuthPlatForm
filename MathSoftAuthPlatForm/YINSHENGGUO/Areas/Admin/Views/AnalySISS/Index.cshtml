
@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_BackGroud.cshtml";
    ViewBag.Id = "a10005";
}

<style>
    .input-group-sm > .form-control, .input-group-sm > .input-group-addon, .input-group-sm > .input-group-btn > .btn {
        padding: 3px 10px;
        font-size: 14px;
    }

    #modelView .modal-body h4, #modelStart .modal-body h4 {
        font-family: 'Microsoft YaHei UI';
        font-size: 14px;
        font-weight: 700;
    }

    hr {
        margin-bottom: 8px;
        margin-top: 8px;
    }

    .nav-tabs > li.active > a, .nav-tabs > li.active > a:focus, .nav-tabs > li.active > a:hover {
        border: none;
        border-bottom: 3px solid #108ee9;
        background: #c4e1ff
    }

    .nav-tabs {
   border:none;
        }

    .tab-content {
       padding:5px;
       padding-top:0;
    }

    a {
    cursor:pointer;
    }
</style>


<script type="text/javascript">
    var t1 = null;
    var optype = 1;

    var t2 = null;

    function initT1() {
        if (t1) {
            t1.draw(true);
            return;
        }
        t1 = $('#t1').DataTable({
            "bAutoWidth": true,
            "aLengthMenu": [10, 15, 20, 50, 100, 200, 500], //更改显示记录数选项
            "iDisplayLength": 15, //默认显示的记录数
            dom: 't<"d"r><"row"<"col-md-2"l><"col-md-2"i><"col-md-8"p>>',
            "processing": true,
            "serverSide": true,
            "sScrollY": $(window).height() - $("#navbar").outerHeight() - 240,
            "bSort": false,
            "bPaginate": true, //是否显示（应用）分页器

            "ajax": {
                "url": "GetData",
                type: "POST",
                datatype: "JSON",
                data: function (d) {
                    d.student_name_idcard = $('#student_name_idcard').val();
                    d.alarm_type = $('#alarm_type').val();
                    d.tuijianrentype = $('#tuijianrentype').val();
                    d.tuijianren = $('#tuijianren').val();
                    d.zhaoshengtype = $("#zhaoshengtype").val();
                   
                }
            },
            "columns": [
                {
                    data: null,
                    render: function (data, type, row, meta) {
                        var content = '<label style="margin:0">';
                        content += '    <input type="checkbox" data-type="selectRow" />';
                        content += '    <span></span>';
                        content += '</label>';
                        return content;
                    },
                    width: "50"
                },
                {
                    "data": null
                },
                {
                    "data": "XSC_IdCard"
                },
                {
                    "data": "XSC_StudentName"
                },

                {
                    "data": "name_Check_Content",
                    width: "100"
                },
                  {
                    "data": "ZSLB"
                },
                {
                    "data": "JYT_StudentSex"
                },
                {
                    "data": "JYT_GrandSchool",
                    width: "80"
                },
                {
                    "data": "FeeItems", render: function (data, type, row, meta) {
                        if (data == 1) {
                            data += "(缴费缺项)"
                        }
                        else if (data==-1) {
                            data += "(缴费2项，金额不足)"
                        }
                        else if (data > 2) {
                            data += "(缴费多项)"
                        }
                        return data;
                    }
                },
                {
                    "data": "Resault_Who"
                },
                {
                    "data": "tuijianren"
                },
                {
                    "data": null, render: function (data, type, row, meta) {
                        return "<button detail class='btn btn-xs btn-link'>查看详情</button>"
                    },
                    'sClass': "text-center"

                }
            ],
            "createdRow": function (row, data, index) {
                if (data.FeeItems != 2) {
                    $(row).find("td").addClass("badgeWaitingLight");
                    $(row).find("td:eq(8)").addClass("badgeWaiting")
                }
                if (data.name_Check == 0) {
                    $(row).find("td").addClass("badgeWaitingLight");
                    $(row).find("td:eq(4)").addClass("badgeWaiting")
                }
            },
            language: {
                "sProcessing": "正在处理数据...",
                "sLengthMenu": "显示 _MENU_ 项结果",
                "sZeroRecords": "没有匹配结果",
                "sInfo": "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
                "sInfoEmpty": "显示第 0 至 0 项结果，共 0 项",
                "sInfoFiltered": "(由 _MAX_ 项结果过滤)",
                "sInfoPostFix": "",
                "sSearch": "搜索:",
                "sUrl": "",
                "sEmptyTable": "表中数据为空",
                "sLoadingRecords": "载入中...",
                "sInfoThousands": ",",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "上页",
                    "sNext": "下页",
                    "sLast": "末页"
                },
                "oAria": {
                    "sSortAscending": ": 以升序排列此列",
                    "sSortDescending": ": 以降序排列此列"
                }
            },
            "fnDrawCallback": function () {
                var api = this.api();
                var startIndex = api.context[0]._iDisplayStart;//获取到本页开始的条数
                api.column(1).nodes().each(function (cell, i) {
                    cell.innerHTML = (startIndex + i + 1);
                });
            }
        });



        $("#ckbSelectAll").change(function () {
            var selected = $(this).prop("checked");

            $('#t1 input[data-type="selectRow"]').prop('checked', selected);
            if (selected) {
                $('#t1 tbody tr ').addClass('selected')
            }
            else {
                $('#t1 tbody tr ').removeClass('selected')
            }


        });


        $('#t1 tbody').on('click', 'tr', function (e) {
            var selected = $(this).find('*[data-type="selectRow"]').prop('checked');
            $(this).find('*[data-type="selectRow"]').prop('checked', !selected);
            if (!selected) {
                $(this).addClass('selected')
            }
            else {
                $(this).removeClass('selected')
            }



        })

        $('#t1 tbody').on("click", 'input[data-type="selectRow"]', function (e) {
            e.stopPropagation();
            var selected = $(this).prop("checked");
            if (selected) {
                $(this).parents("tr").addClass("selected");
            }
            else {
                $(this).parents("tr").removeClass("selected");
            }
        });

        $('#t1 tbody').on("click", 'button[detail]', function (e) {
            e.stopPropagation();
            var tr = $(this).closest('tr');
            var row = t1.row(tr);
            var data = row.data();

            $('#modelView').modal();

            var Is_shengyuanjidi = data.Is_shengyuanjidi;
            var a1 = Is_shengyuanjidi ? "是" : "否";
            data.Is_shengyuanjidi = a1;

            var Is_jiaofei = data.Is_jiaofei;
            var a2 = Is_jiaofei ? "是" : "否";
            data.Is_jiaofei = a2;

            var Is_baodao = data.Is_baodao;
            var a3 = Is_baodao ? "是" : "否";
            data.Is_baodao = a3;

            for (var sth in data) {
                $("#Div" + sth).html(data[sth])
            }

            if (data.Is_Warning) {
                $("#cc1").addClass("badgeWaiting");
            }
            else {
                $("#cc1").removeClass("badgeWaiting");
            }
        });
    }

    function initT2() {
        if (t2) {
            t2.draw(true);
            return;
        }
        t2 = $('#t2').DataTable({
            "bAutoWidth": true,
            "aLengthMenu": [10,15, 20, 50, 100, 200, 500], //更改显示记录数选项
            "iDisplayLength": 15, //默认显示的记录数
            dom: 't<"d"r><"row"<"col-md-2"i><"col-md-8"p>>',
            "processing": true,
            "serverSide": true,
            "sScrollY": $(window).height() - $("#navbar").outerHeight() - 150,
            "bSort": false,
            "bPaginate": false, //是否显示（应用）分页器
            "ajax": {
                "url": "GetStaticData",
                type: "POST",
                datatype: "JSON",
                data: function (d) {
                    d.alarm_type = $('#alarm_type2').val();
                }
            },
            "columns": [
                {
                    data: null,
                    render: function (data, type, row, meta) {
                        var content = '<label style="margin:0">';
                        content += '    <input type="checkbox" data-type="selectRow" />';
                        content += '    <span></span>';
                        content += '</label>';
                        return content;
                    },
                    width: "50"
                },
                {
                    "data": null
                },
                {
                    data:"Math_Dept_Name"
                },
                {
                    "data": "Name"
                },
                {
                    "data": "Value3",
                    render: function (data, type, row, meta) {
                        if (data == "_") {
                            return data;
                        }
                        else {
                            var content = '<a data-type="showDetail" data-name="' + row.Name + '">';
                            content += data
                            content += '</a>';
                            return content;
                        }
                      
                    },
                },
                {
                    "data": "Value"
                },
                {
                    "data": "Value2"
                },
                {
                    "data": "rate"
                }
                
            ],
            language: {
                "sProcessing": "正在处理数据...",
                "sLengthMenu": "显示 _MENU_ 项结果",
                "sZeroRecords": "没有匹配结果",
                "sInfo": "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
                "sInfoEmpty": "显示第 0 至 0 项结果，共 0 项",
                "sInfoFiltered": "(由 _MAX_ 项结果过滤)",
                "sInfoPostFix": "",
                "sSearch": "搜索:",
                "sUrl": "",
                "sEmptyTable": "表中数据为空",
                "sLoadingRecords": "载入中...",
                "sInfoThousands": ",",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "上页",
                    "sNext": "下页",
                    "sLast": "末页"
                },
                "oAria": {
                    "sSortAscending": ": 以升序排列此列",
                    "sSortDescending": ": 以降序排列此列"
                }
            },
            "fnDrawCallback": function () {
                var api = this.api();
                var startIndex = api.context[0]._iDisplayStart;//获取到本页开始的条数
                api.column(1).nodes().each(function (cell, i) {
                    cell.innerHTML = '<span class="label label-success">' + (startIndex + i + 1) + '</span>'
                });
            }
        });



        $("#ckbSelectAll2").change(function () {
            var selected = $(this).prop("checked");

            $('#t2 input[data-type="selectRow"]').prop('checked', selected);
            if (selected) {
                $('#t2 tbody tr ').addClass('selected')
            }
            else {
                $('#t2 tbody tr ').removeClass('selected')
            }
        });


        $('#t2 tbody').on('click', 'tr', function (e) {
            var selected = $(this).find('*[data-type="selectRow"]').prop('checked');
            $(this).find('*[data-type="selectRow"]').prop('checked', !selected);
            if (!selected) {
                $(this).addClass('selected')
            }
            else {
                $(this).removeClass('selected')
            }



        })

        $('#t2 tbody').on("click", 'input[data-type="selectRow"]', function (e) {
            e.stopPropagation();
            var selected = $(this).prop("checked");
            if (selected) {
                $(this).parents("tr").addClass("selected");
            }
            else {
                $(this).parents("tr").removeClass("selected");
            }
        });

        $('#t2 tbody').on("click", 'button[detail]', function (e) {
            e.stopPropagation();
            var tr = $(this).closest('tr');
            var row = t1.row(tr);
            var data = row.data();

            $('#modelView').modal();

            var Is_shengyuanjidi = data.Is_shengyuanjidi;
            var a1 = Is_shengyuanjidi ? "是" : "否";
            data.Is_shengyuanjidi = a1;

            var Is_jiaofei = data.Is_jiaofei;
            var a2 = Is_jiaofei ? "是" : "否";
            data.Is_jiaofei = a2;

            var Is_baodao = data.Is_baodao;
            var a3 = Is_baodao ? "是" : "否";
            data.Is_baodao = a3;

            for (var sth in data) {
                $("#Div" + sth).html(data[sth])
            }

            if (data.Is_Warning) {
                $("#cc1").addClass("badgeWaiting");
            }
            else {
                $("#cc1").removeClass("badgeWaiting");
            }

        });

        $('#t2 tbody').on("click", 'a[data-type="showDetail"]', function (e) {
            e.stopPropagation();
            var tr = $(this).closest('tr');
            var row = t2.row(tr);
            var data = row.data();
            window.open(encodeURI("../../WebForm7.aspx?Name=" + data.Name+"&&type=1"));

        });
    }

    $(document).ready(function () {
        $('#btnOutcel').click(function () {
            window.open("GetExcel?student_name_idcard=" + $('#student_name_idcard').val() + "&alarm_type=" + $('#alarm_type').val()
                + "&tuijianrentype=" + $('#tuijianrentype').val()
                + "&tuijianren=" + $('#tuijianren').val()
            )
        })

        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            if ($(this).attr("href") === "#profile") {
                initT2();
            }
        })

        

        $('#btnSearch').click(function () {
            t1.draw(true);
        });

        $('#btnSearch2').click(function () {
            t2.draw(true);
        });

        $('#btnAddUser').click(function () {
            optype = 1;
            $("#form1").get(0).reset();
            $("#form1").validate().resetForm(); //清除验证
            $("#myModalLabel").html("新建菜单")
            $('#modelZhong').modal();
        });
        initT1();

        jQuery.validator.addMethod("positiveinteger", function (value, element) {
            var aint = parseInt(value);
            return aint >= 0 && (aint + "") == value;
        }, "请输入非负数");

        $("#form1").validate({
            rules: {
                MenuIcon: {
                    required: true
                },
                MenuOrderBy: {
                    positiveinteger: true
                }
            },
            submitHandler: function (form) {
                var data = $(form).serialize();
                if (optype === 1) {
                    $.ajax({
                        url: "AddMenu",
                        data: $(form).serialize(),
                        success: function (data) {
                            if (data.suc) {
                                layer.msg('新建成功', { icon: 1 })
                                $('#modelZhong').modal('hide');
                                t1.draw(true);
                            }
                            else {
                                layer.msg(data.remark, { icon: 2 })
                            }
                        },
                        dataType: "JSON",
                        type: "POST"
                    })
                }
                else {

                    $.ajax({
                        url: "UpdateMenu",
                        data: $(form).serialize(),
                        success: function (data) {
                            if (data.suc) {
                                layer.msg('更新成功', { icon: 1 })
                                $('#modelZhong').modal('hide');
                                t1.draw(false);
                            }
                            else {
                                layer.msg(data.remark, { icon: 2 })
                            }
                        },
                        dataType: "JSON",
                        type: "POST"
                    })
                }
            }
        });


        $('#btnBatchDelete').click(function () {

            var data = [];
            var l = t1.rows('.selected').data().length;
            if (l) {
                for (var i = 0; i < l; i++) {
                    data.push(t1.rows('.selected').data()[i].MenuId);
                }
                var resStr = JSON.stringify(data);

                layer.confirm('您确定要删除这' + l + '条数据吗？', {
                    btn: ['确定', '取消'] //按钮
                }, function () {
                    $.ajax({
                        'url': "DeleteMenuBatch",
                        data: { "MenuIds": resStr },
                        success: function (data) {
                            if (data.suc) {
                                layer.msg(data.remark, { icon: 1 })
                                t1.draw(true);
                            }
                            else {
                                layer.msg(data.remark, { icon: 2 })
                            }
                        }
                    })
                });
            }
            else {
                layer.alert("您没有选中任何一行", { icon: 2 })
            }
        })

        $("#chbSelecteAll").change(function () {
            $('#formRoleSend .modal-body :checkbox').prop("checked", $(this).prop("checked"))
        })
    });
</script>

<div aria-hidden="true" data-backdrop="static" class="modal fade" id="modelView" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form class="form-horizontal" id="form3">

                <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">  <i class="glyphicon glyphicon-remove-circle"></i></button>
                    <h4 class="modal-title" id="myModalLabel">学生基本信息</h4>
                </div>
                <div class="modal-body">
                    <div class="minHeight100">
                        <div class="row">
                            <div class="col-md-2 col-sm-2 col-xs-2 text-right"><h4>学生姓名</h4></div>
                            <div class="col-md-4 col-sm-4 col-xs-4 text-left text-info"><h4 id="DivJYT_StudentName">未指定</h4></div>
                            <div class="col-md-2 col-sm-2 col-xs-2 text-right"><h4>性别</h4></div>
                            <div class="col-md-4 col-sm-4 col-xs-4 text-left text-info"><h4 id="DivJYT_StudentSex">未指定</h4></div>
                        </div>
                        <hr/>

                        <div class="row">
                            <div class="col-md-2 col-sm-2 col-xs-2 text-right"><h4>身份证号</h4></div>
                            <div class="col-md-4 col-sm-4 col-xs-4 text-left text-info"><h4 id="DivJYT_IdCard">未指定</h4></div>
                            <div class="col-md-2 col-sm-2 col-xs-2 text-right"><h4>原中学</h4></div>
                            <div class="col-md-4 col-sm-4 col-xs-4 text-left text-info"><h4 id="DivJYT_GrandSchool">未指定</h4></div>
                        </div>
                        <hr/>
                        <div class="row" id="cc1">
                            <div class="col-md-2 col-sm-2 col-xs-2 text-right text-nowrap"><h4>是否缴费</h4></div>
                            <div class="col-md-4 col-sm-4 col-xs-4 text-left text-info"><h4 id="DivIs_jiaofei">未指定</h4></div>
                        </div>
                        <hr/>

                        <div class="row">
                            <div class="col-md-2 col-sm-2 col-xs-2 text-right text-nowrap"><h4>是否生源基地</h4></div>
                            <div class="col-md-4 col-sm-4 col-xs-4 text-left text-info"><h4 id="DivIs_shengyuanjidi">未指定</h4></div>
                            <div class="col-md-2 col-sm-2 col-xs-2 text-right"><h4>推荐人</h4></div>
                            <div class="col-md-4 col-sm-4 col-xs-4 text-left text-info">
                                <h4 id="DivResault_Who">
                                    未指定
                                </h4>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary btn-sm" data-dismiss="modal">
                        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                        关闭
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<ul class="nav nav-tabs" role="tablist" id="tablist1" style="margin-top:10px">
    <li role="presentation" class="active">
        <a href="#home" aria-controls="home" role="tab" data-toggle="tab" id="a0" data-index="0" style="padding:5px 15px">
            <span class="octicon  octicon-file-directory" aria-hidden="true"></span>
            常规报表
        </a>
    </li>

    <li role="presentation">
        <a href="#profile" aria-controls="profile" role="tab" data-toggle="tab" id="a1" data-index="1" style="padding:5px 15px">
            <span class="octicon octicon-graph" aria-hidden="true"></span>
            统计报表
        </a>
    </li>

    <a class="btn btn-primary btn-sm" id="btnOutcel" style="float:right">
        <i class="glyphicon glyphicon-save-file"></i>
        导出EXCEL
    </a>
</ul>

<div class="tab-content">

    <div id="home" role="tabpanel" class="tab-pane active">
        <div class="row" style="margin-top:10px;">
            <div class="col-lg-4 col-md-4 col-sm-4">
                <div class="input-group  input-group-sm ">
                    <span class="input-group-addon" id="basic-addon1">数据类型</span>
                    <select class="form-control"
                            aria-describedby="basic-addon1"
                            id="zhaoshengtype">
                        <option value="">--请选择--</option>
                        <option value="单招">单招</option>
                        <option value="统招">统招</option>
                        <option value="五年一贯制">五年一贯制</option>
                        <option value="中专">中专</option>
                    </select>
                </div>
            </div>

            <div class="col-lg-4 col-md-4 col-sm-4">
                <div class="input-group  input-group-sm ">
                    <span class="input-group-addon" id="basic-addon1">告警类型</span>
                    <select class="form-control"
                            aria-describedby="basic-addon1"
                            id="alarm_type">
                        <option value="">--请选择--</option>
                        <option value="2">正常的</option>
                        <option value="-1">缴费异常</option>
                        <option value="1111">学生姓名不一致</option>
                    </select>
                </div>
            </div>
 
            <div class="col-lg-4 col-md-4 col-sm-4">
 
                <div class="input-group  input-group-sm ">
                    <span class="input-group-addon" id="basic-addon1">推荐人类型</span>
                    <select class="form-control"
                            aria-describedby="basic-addon1"
                            id="tuijianrentype">
                        <option value="">--请选择--</option>
                        <option value="1">自然生源</option>
                        <option value="2">教职工</option>
                        <option value="3">生源基地</option>
                    </select>
                </div>
            </div>

        </div>

        <div class="row" style="margin-top:5px;">

            <div class="col-lg-4 col-md-4 col-sm-4">

                <div class="input-group  input-group-sm ">
                    <span class="input-group-addon" id="basic-addon1">推荐人</span>
                    <input type="text"
                           class="form-control"
                           aria-describedby="basic-addon1"
                           id="tuijianren"
                           placeholder="请输入推荐人">
                </div>
            </div>

            <div class="col-lg-4 col-md-4 col-sm-4">

                <div class="input-group  input-group-sm ">
                    <span class="input-group-addon" id="basic-addon1">学生信息</span>
                    <input type="text"
                           class="form-control"
                           aria-describedby="basic-addon1"
                           id="student_name_idcard"
                           placeholder="学生姓名,身份证号">
                </div>
            </div>
            <div class="col-lg-1 col-md-1 col-sm-1" role="group" aria-label="...">
                <button type="button" class="btn btn-primary btn-sm" id="btnSearch">
                    <i class="
glyphicon glyphicon-search"></i> &nbsp;
                    查询
                </button>
            </div>
        </div>

        <div style="margin-top:10px;">
            <table id="t1" class="table  table-condensed table-responsive  ">
                <thead>
                    <tr>
                        <th>
                            <label style="margin:0">
                                <input id="ckbSelectAll" type="checkbox" />
                                全选
                            </label>
                        </th>
                        <th>序号</th>
                        <th>学生身份证</th>
                        <th>学生姓名</th>
                        <th>学生姓名差异</th>
                        <th>招生类别</th>
                        <th>学生性别</th>
                        <th>毕业学校</th>
                        <th>缴费次数</th>
                        <th>推荐人</th>
                        <th>推荐人类型</th>
                        <th>操作</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>

    <div id="profile" role="tabpanel" class="tab-pane">
        <div style="margin-top:10px;">
            <table id="t2" class="table  table-condensed table-responsive table-striped ">
                <thead>
                    <tr>
                        <th>
                            <label style="margin:0">
                                <input id="ckbSelectAll2" type="checkbox" />
                                全选
                            </label>
                        </th>
                        <th>序号</th>
                        <th>部门</th>
                        <th>招生人员</th>
                        <th>辖区内命中人数</th>
                        <th>总命中人数</th>
                        <th>基数</th>
                        <th>命中率</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
    </div>


